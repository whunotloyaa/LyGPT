<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>LyGPT â€” Frontend local</title>
<style>
  @keyframes nebula {
    0% {background-position: 0% 50%;}
    50% {background-position: 100% 50%;}
    100% {background-position: 0% 50%;}
  }
  :root { --bg1:#4a0000; --bg2:#b00000; --bg3:#600000; --bg4:#200000; }
  body{
    font-family: "Segoe UI", Roboto, Arial, sans-serif;
    margin:0; min-height:100vh; color:#f5f5f5;
    background: linear-gradient(-45deg, var(--bg1), var(--bg2), var(--bg3), var(--bg4));
    background-size: 400% 400%; animation: nebula 25s ease infinite;
    display:flex; flex-direction:column;
  }
  .container{ max-width:980px; margin:auto; padding:28px; flex:1; display:flex; flex-direction:column; gap:12px;}
  h1{ text-align:center; color:#ffb3b3; margin:0 0 8px; text-shadow:0 0 10px rgba(255,50,50,0.7);}
  .small{ font-size:0.85rem; color:#ddd; }
  .chat{ background:rgba(0,0,0,0.45); padding:16px; border-radius:12px; min-height:360px; overflow:auto; box-shadow:0 0 20px rgba(255,0,0,0.25);}
  .controls{ display:flex; gap:8px; align-items:center; justify-content:center; flex-wrap:wrap; }
  input[type="text"] { padding:10px; border-radius:8px; border:none; background: rgba(0,0,0,0.5); color:#fff; min-width:220px;}
  button{ padding:10px 14px; border-radius:8px; border:none; background:rgba(0,0,0,0.55); color:#fff; cursor:pointer;}
  button:active{ transform:translateY(1px); }
  .user{ color:#ffd166; margin:8px 0; }
  .bot{ color:#a6e3e9; margin:8px 0; }
  pre{ background:rgba(0,0,0,0.6); padding:10px; border-radius:8px; overflow:auto;}
  footer{ text-align:center; color:#ffaaaa; padding:10px; font-size:0.9rem; background:rgba(0,0,0,0.2); border-top:1px solid rgba(255,255,255,0.05); }
  @media(max-width:640px){
    .container{ padding:16px }
    input[type="text"]{ min-width:140px }
  }
</style>
</head>
<body>
  <div class="container">
    <h1>ðŸš€ LyGPT </h1>

    <div class="chat" id="chat" aria-live="polite" role="log"></div>

    <div class="controls">
      <input id="q" type="text" placeholder="Ex: gÃ©nÃ¨re un script express sqlite" />
      <button id="sendBtn">Envoyer</button>
    </div>
  </div>

  <footer>DÃ©veloppÃ© et rÃ©alisÃ© par Loyaa</footer>

<script>
/* Portage JS de human_assistant.py (mode local uniquement)
   - dÃ©tection banned keywords
   - templates
   - logique locale
   - historique local (non affichÃ©)
*/

const BOT_NAME = "LyGPT";
const DEFAULT_USER = "user01";
const BANNED_KEYWORDS = [
  "stealer","rat","ransom","ransomware","malware","keylogger",
  "idos","dos","botnet","exploit","oday","cheat","aimbot","wallback",
  "phishing","cracker","token grab","tokengrabbler","password dumper",
  "credit card","carder","skimmer","exploit","shellcode","reverse shell"
];

const TEMPLATES = {
  express_api: `// Express minimal CRUD example (JS)
const express = require('express'), app = express();
app.use(express.json());
let items = [];
app.get('/items',(req,res)=>res.json(items));
app.post('/items',(req,res)=>{
  const i = { id: items.length+1, ...req.body };
  items.push(i);
  res.json(i);
});
app.listen(3000,()=>console.log('Listening :3000'));`,
  python_starter: `# Python starter
def main():
    print('Dis-moi prÃ©cisÃ©ment ce que tu veux: langage, objectif, framework')

if __name__ == '__main__':
    main()`
};

// ---------- util ----------
function nowISO(){ return (new Date()).toISOString(); }
function containsBanned(text){
  const t = (text||"").toLowerCase();
  for(const kw of BANNED_KEYWORDS){
    if(t.includes(kw)) return [true, kw];
  }
  return [false, null];
}
function humanize(text){
  const prefixes = ["","FrÃ©rot, ",""];
  const suffixes = [""," ðŸ˜‰"," ðŸ”¥"," âœ…"," ðŸ˜Ž"];
  return prefixes[Math.floor(Math.random()*prefixes.length)] + text + suffixes[Math.floor(Math.random()*suffixes.length)];
}
function escapeHtml(unsafe){
  if(!unsafe) return "";
  return unsafe.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;");
}

// ---------- history (localStorage) ----------
const HISTORY_KEY = "lygpt_history_v1";
function saveHistory(user, message, response){
  try{
    const h = JSON.parse(localStorage.getItem(HISTORY_KEY) || "[]");
    h.unshift({ user, message, response, ts: nowISO() });
    localStorage.setItem(HISTORY_KEY, JSON.stringify(h.slice(0,500)));
  }catch(e){ console.warn("saveHistory", e); }
}
function getHistory(n=50){
  try{ return JSON.parse(localStorage.getItem(HISTORY_KEY) || "[]").slice(0,n); }
  catch(e){ return []; }
}

// ---------- render ----------
const chatEl = document.getElementById("chat");
function append(role, text){
  const d = document.createElement("div");
  d.className = role;
  const header = role === "user" ? "ðŸ‘¤ Toi:" : `ðŸ¤– ${BOT_NAME}:`;
  let safe = escapeHtml(text || "");
  safe = safe.replace(/```(js|py)?\n([\s\S]*?)```/g, (m,lang,code)=>{
    return `<pre><code>${escapeHtml(code)}</code></pre>`;
  }).replace(/\n/g,"<br>");
  d.innerHTML = `<strong>${header}</strong><div>${safe}</div>`;
  chatEl.appendChild(d);
  chatEl.scrollTop = chatEl.scrollHeight;
}

// ---------- assistant logic (local) ----------
function localRespond(userText){
  const text = (userText||"").trim();
  if(!text) return humanize("Ã‰cris quelque chose, frÃ©rot.");

  const [banned, kw] = containsBanned(text);
  if(banned){
    const resp = humanize(
      `Je ne peux pas t'aider sur ce sujet (${kw}). ` +
      "Si tu veux, je peux:\n- t'expliquer de faÃ§on thÃ©orique les concepts (sÃ©curitÃ© informatique, tests, etc.)\n- te fournir des exercices et labs lÃ©gaux\n- t'aider Ã  Ã©crire des outils d'administration/scripting lÃ©gitimes\n"
    );
    saveHistory(DEFAULT_USER, text, resp);
    return resp;
  }

  const low = text.toLowerCase();

  if(/\b(salut|hello|hey|yo|coucou)\b/.test(low)){
    const r = humanize(`Salut ${DEFAULT_USER} â€” dis-moi ce que tu veux coder, apprendre ou rechercher.`);
    saveHistory(DEFAULT_USER, text, r);
    return r;
  }
  if(/\b(Ã§a va|comment Ã§a va|bien|quoi de neuf)\b/.test(low)){
    const r = humanize("Ã‡a roule â€” prÃªt Ã  t'aider. Tu veux un snippet, un guide ou un tuto ?");
    saveHistory(DEFAULT_USER, text, r);
    return r;
  }

  const m = low.match(/(gÃ©nÃ¨r|donne|fais|file|crÃ©e|Ã©cris|generate|create)\s+(un|une|des)?\s*(.*)/);
  if(m){
    const topic = (m[3]||"").trim();
    if(topic.includes("express") || topic.includes("api")){
      const snippet = TEMPLATES.express_api;
      const resp = `Ok, voilÃ  un starter Express pour une API simple :\n\n\`\`\`js\n${snippet}\n\`\`\`\nVeux-tu que je l'adapte (DB, auth) ?`;
      saveHistory(DEFAULT_USER, text, resp);
      return resp;
    }
    if(topic.includes("python") || topic.includes("starter")){
      const snippet = TEMPLATES.python_starter;
      const resp = `Voici un starter Python :\n\n\`\`\`py\n${snippet}\n\`\`\`\nDis-moi l'objectif exact et j'adapte.`;
      saveHistory(DEFAULT_USER, text, resp);
      return resp;
    }
    // fallback
    const snippet = TEMPLATES.python_starter;
    const resp = `Je peux te faire Ã§a. En attendant, un starter :\n\n\`\`\`py\n${snippet}\n\`\`\`\nPrÃ©cise langage + objectif.`;
    saveHistory(DEFAULT_USER, text, resp);
    return resp;
  }

  const m2 = low.match(/(comment|comment faire|how to)\s+(.*)/);
  if(m2){
    const topic = (m2[2]||"").trim();
    const resp = humanize(`Pour ${topic}, commence par dÃ©finir l'objectif prÃ©cis, choisis le langage et cherche une librairie adaptÃ©e. Je peux te donner un guide pas-Ã -pas si tu prÃ©cises langage et but.`);
    saveHistory(DEFAULT_USER, text, resp);
    return resp;
  }

  const fallback = humanize("J'ai pas tout saisi â€” dis en 1 phrase : langage (python/js), objectif (API, scraping, automation), framework ?");
  saveHistory(DEFAULT_USER, text, fallback);
  return fallback;
}

// ---------- UI wiring ----------
document.getElementById("sendBtn").addEventListener("click", send);
document.getElementById("q").addEventListener("keydown", e => { if(e.key === "Enter") send(); });

function send(){
  const qEl = document.getElementById("q");
  const v = (qEl.value || "").trim();
  if(!v) return;
  append("user", v);
  qEl.value = "";
  const local = localRespond(v);
  append("bot", local);
}

// initialize UI state
(function init(){
  append("bot", humanize("Salut de quoi as tu besoins, j'ai Ã©tÃ© dev par loyaa et je suis la pour t'aider."));
})();
</script>
</body>
</html>


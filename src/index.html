<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>LyGPT</title>
<style>
  @keyframes nebula {
    0% {background-position: 0% 50%;}
    50% {background-position: 100% 50%;}
    100% {background-position: 0% 50%;}
  }
  :root { --bg1:#a30000; --bg2:#a30000; --bg3:#000000; --bg4:#830000; }
  body{
    font-family: "Segoe UI", Roboto, Arial, sans-serif;
    margin:0; min-height:100vh; color:#f5f5f5;
    background: linear-gradient(-45deg, var(--bg1), var(--bg2), var(--bg3), var(--bg4));
    background-size: 400% 400%; animation: nebula 25s ease infinite;
    display:flex; flex-direction:column;
  }
  .container{ max-width:980px; margin:auto; padding:28px; flex:1; display:flex; flex-direction:column; gap:12px;}
  h1{ text-align:center; color:#ffb3b3; margin:0 0 8px; text-shadow:0 0 10px rgba(255,50,50,0.7);}
  .chat{ background:rgba(0,0,0,0.45); padding:16px; border-radius:12px; min-height:360px; overflow:auto; box-shadow:0 0 20px rgba(255,0,0,0.25);}
  .controls{ display:flex; gap:8px; align-items:center; justify-content:center; flex-wrap:wrap; }
  input[type="text"] { padding:10px; border-radius:8px; border:none; background: rgba(0,0,0,0.5); color:#fff; min-width:220px;}
  button{ padding:10px 14px; border-radius:8px; border:none; background:rgba(0,0,0,0.55); color:#fff; cursor:pointer;}
  button:active{ transform:translateY(1px); }
  .user{ color:#ffd166; margin:8px 0; }
  .bot{ color:#a6e3e9; margin:8px 0; }
  pre{ background:rgba(0,0,0,0.6); padding:10px; border-radius:8px; overflow:auto;}
  footer{ text-align:center; color:#ffaaaa; padding:10px; font-size:0.9rem; background:rgba(0,0,0,0.2); border-top:1px solid rgba(255,255,255,0.05); }
  @media(max-width:640px){
    .container{ padding:16px }
    input[type="text"]{ min-width:140px }
  }
</style>
</head>
<body>
  <div class="container">
    <h1>üèÆ LyGPT</h1>
    <div class="chat" id="chat" aria-live="polite" role="log"></div>
    <div class="controls">
      <input id="q" type="text" placeholder="Ecrie quelque chose autiste va" />
      <button id="sendBtn">Envoyer</button>
    </div>
  </div>
  <footer>D√©velopp√© et r√©alis√© par Ly</footer>

<script>
// ---------- UTIL ----------
function escapeHtml(unsafe){ 
  return (unsafe||"").replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;"); 
}

// ---------- CHAT RENDERING ----------
const chatEl = document.getElementById("chat");
function append(role, text){
  const d = document.createElement("div");
  d.className = role;
  const header = role === "user" ? "üë§ Toi:" : `ü§ñ LyGPT:`;
  let safe = escapeHtml(text);
  safe = safe.replace(/```(js|py)?\n([\s\S]*?)```/g, (_,lang,code)=>{
    return `<pre><code>${escapeHtml(code)}</code></pre>`;
  }).replace(/\n/g,"<br>");
  d.innerHTML = `<strong>${header}</strong><div>${safe}</div>`;
  chatEl.appendChild(d);
  chatEl.scrollTop = chatEl.scrollHeight;
}

// ---------- OPENAI API CALL VIA BACKEND ----------
async function sendOpenAI(userText){
  try {
    const resp = await fetch("/api/chat", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ message: userText })
    });
    const data = await resp.json();
    return data.reply || "Pas de r√©ponse.";
  } catch(e) {
    console.error(e);
    return "Erreur API OpenAI";
  }
}

// ---------- UI WIRING ----------
document.getElementById("sendBtn").addEventListener("click", send);
document.getElementById("q").addEventListener("keydown", e => { if(e.key === "Enter") send(); });

async function send(){
  const qEl = document.getElementById("q");
  const v = (qEl.value||"").trim();
  if(!v) return;
  append("user", v);
  qEl.value = "";
  const response = await sendOpenAI(v);
  append("bot", response);
}

// INITIALIZE
append("bot", "Salut ! De quoi as-tu besoin ? Je suis LyGPT, d√©velopp√© par Loyaa.");
</script>
</body>
</html>
